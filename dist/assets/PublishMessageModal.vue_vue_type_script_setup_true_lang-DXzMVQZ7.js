import{x as k,O as y,F as a,r as f,f as N,s as fe,G as re,L as be,Q as C,u as A,H as P,w as me,R as Ie,S as _e,D as pe,E as V,y as L,I as F,Z as se,K as he,_ as ve,A as $e,a2 as Ce}from"./vendor-C_kCRdsv.js";import{a as Me,t as le,s as xe,x as ke,d as je,w as Ne,g as ge,e as Se,D as Pe}from"./index-CET3MO9v.js";import{u as Ae}from"./messageTemplates-BIHD0qL0.js";import{d as Ee}from"./pinia-B2SWLoi0.js";import{_ as we}from"./BaseModal.vue_vue_type_script_setup_true_lang-CbCA5KVJ.js";import{r as Ve}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-BtIlvEIB.js";import{r as De}from"./DocumentDuplicateIcon-Bk0JYA52.js";function Oe(T,i){return y(),k("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"})])}const Be=Ee("topics",()=>{const T=Me(),i=f({state:"idle",error:null,lastUpdated:null}),n=f([]),h=f(null),j=f(new Map),x=f({projectId:"",namePattern:"",labels:{},states:[],dateRange:void 0}),I=f({pageSize:50,pageToken:void 0,orderBy:"name",filter:""}),b=f(new Map),d=f(!0),p=f(new Map),c=N(()=>T.selectedProject?n.value.filter(t=>t.projectId===T.selectedProject.projectId):[]),g=N(()=>{let t=[...c.value];if(x.value.namePattern){const o=x.value.namePattern.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(o)||l.fullName.toLowerCase().includes(o))}return x.value.labels&&Object.keys(x.value.labels).length>0&&(t=t.filter(o=>o.labels?Object.entries(x.value.labels).every(([l,u])=>o.labels[l]===u):!1)),x.value.states&&x.value.states.length>0&&(t=t.filter(o=>o.state&&x.value.states.includes(o.state))),x.value.dateRange&&(t=t.filter(o=>{const l=new Date(o.createdAt);return l>=x.value.dateRange.start&&l<=x.value.dateRange.end})),t}),M=N(()=>({total:c.value.length,active:c.value.filter(t=>t.state==="ACTIVE").length,withSchema:c.value.filter(t=>t.schemaSettings).length,withKms:c.value.filter(t=>t.kmsKeyName).length,totalMessages:c.value.reduce((t,o)=>t+(o.messageCount||0),0),totalSubscriptions:c.value.reduce((t,o)=>t+(o.subscriptionsCount||0),0)})),D=N(()=>i.value.state==="loading"),R=N(()=>i.value.state==="error"),w=N(()=>Array.from(b.value.values()).filter(t=>t.status==="PENDING"||t.status==="RUNNING"));async function O(t,o={}){try{i.value.state="loading",i.value.error=null;const l=t||T.selectedProject?.projectId;if(!l)throw new Error("No project selected");Object.assign(I.value,o);const m=(await le.getTopics(l)).map(s=>{const e=s.projectId||l;let r=s.name;return s.name&&s.name.includes("/topics/")&&(r=s.name.split("/topics/")[1]),{...s,projectId:e,name:r,fullName:s.name||`projects/${e}/topics/${r}`,id:s.id||`${e}-${r}`,createdAt:s.createdAt||new Date,updatedAt:s.updatedAt||new Date,state:s.state||"ACTIVE",messageCount:s.messageCount||0,subscriptionsCount:s.subscriptionsCount||0}});n.value=n.value.filter(s=>s.projectId!==l),n.value.push(...m),m.forEach(s=>{p.value.set(s.fullName,s)}),i.value.state="success",i.value.lastUpdated=new Date}catch(l){throw i.value.state="error",i.value.error=l.message,l}}async function B(t,o){try{const l=o||T.selectedProject?.projectId;if(!l)throw new Error("No project selected");const u=t.startsWith("projects/")?t:`projects/${l}/topics/${t}`;if(p.value.has(u))return p.value.get(u);i.value.state="loading",i.value.error=null;const m={id:`${l}-${t}`,name:t,fullName:u,projectId:l,createdAt:new Date,updatedAt:new Date,labels:{},state:"ACTIVE",messageCount:Math.floor(Math.random()*1e4),subscriptionsCount:Math.floor(Math.random()*10)};await new Promise(e=>setTimeout(e,400)),p.value.set(u,m);const s=n.value.findIndex(e=>e.fullName===u);return s===-1?n.value.push(m):n.value[s]=m,i.value.state="success",i.value.lastUpdated=new Date,m}catch(l){throw i.value.state="error",i.value.error=l.message,l}}async function E(t){try{i.value.state="loading",i.value.error=null;const o=`projects/${t.projectId}/topics/${t.name}`;if(n.value.some(u=>u.fullName===o))throw new Error(`Topic ${t.name} already exists`);const l={id:`${t.projectId}-${t.name}-${Date.now()}`,name:t.name,fullName:o,projectId:t.projectId,createdAt:new Date,updatedAt:new Date,labels:t.labels||{},messageStoragePolicy:t.messageStoragePolicy,kmsKeyName:t.kmsKeyName,schemaSettings:t.schemaSettings,state:"ACTIVE",messageCount:0,subscriptionsCount:0};return await new Promise(u=>setTimeout(u,1e3)),n.value.push(l),p.value.set(o,l),i.value.state="success",i.value.lastUpdated=new Date,l}catch(o){throw i.value.state="error",i.value.error=o.message,o}}async function W(t,o,l){try{const u=l||T.selectedProject?.projectId;if(!u)throw new Error("No project selected");const m=t.startsWith("projects/")?t:`projects/${u}/topics/${t}`;i.value.state="loading",i.value.error=null;const s=n.value.findIndex(r=>r.fullName===m);if(s===-1)throw new Error(`Topic ${t} not found`);const e={...n.value[s],...o,updatedAt:new Date};return await new Promise(r=>setTimeout(r,600)),n.value[s]=e,p.value.set(m,e),i.value.state="success",i.value.lastUpdated=new Date,e}catch(u){throw i.value.state="error",i.value.error=u.message,u}}async function U(t,o){try{const l=o||T.selectedProject?.projectId;if(!l)throw new Error("No project selected");const u=t.startsWith("projects/")?t:`projects/${l}/topics/${t}`;i.value.state="loading",i.value.error=null;const m=t.replace(/^projects\/[^/]+\/topics\//,"");try{const e=await xe.getSubscriptions(l),r=e.filter($=>{const z=$.topicName||$.topic?.replace(/^projects\/[^/]+\/topics\//,""),Q=$.topicName||$.topic;return z===m||Q===`projects/${l}/topics/${m}`||$.topic===`projects/${l}/topics/${m}`}),v=e.filter($=>($.topic||$.topicName)==="_deleted-topic_"),ce=[...r,...v].filter(($,z,Q)=>z===Q.findIndex(Te=>Te.name===$.name));for(const $ of ce){const z=$.name.replace(/^projects\/[^/]+\/subscriptions\//,"");try{await xe.deleteSubscription(l,z)}catch(Q){console.warn(`Failed to delete subscription ${z}:`,Q)}}}catch(e){console.warn("Failed to delete related subscriptions:",e)}await le.deleteTopic(l,m);const s=n.value.findIndex(e=>e.fullName===u);s>-1&&n.value.splice(s,1),p.value.delete(u),j.value.delete(u),h.value?.fullName===u&&(h.value=null),i.value.state="success",i.value.lastUpdated=new Date}catch(l){throw i.value.state="error",i.value.error=l.message,l}}async function S(t,o,l){const u=o||T.selectedProject?.projectId;if(!u)throw new Error("No project selected");const m=t.startsWith("projects/")?t:`projects/${u}/topics/${t}`,s={messageCount:G(50,l),messageBytes:G(1024,l),publishMessageCount:G(30,l),publishedMessageBytes:G(512,l),publishRequestCount:G(20,l)};return await new Promise(e=>setTimeout(e,500)),j.value.set(m,s),s}async function K(t){const o=`batch-create-topics-${Date.now()}`,l={id:o,type:"CREATE_TOPICS",status:"PENDING",items:t,progress:0,errors:[],createdAt:new Date};return b.value.set(o,l),setTimeout(async()=>{l.status="RUNNING";for(let u=0;u<t.length;u++)try{await E(t[u]),l.progress=(u+1)/t.length*100}catch(m){l.errors.push({code:500,message:m.message,details:[t[u]],timestamp:new Date})}l.status=l.errors.length>0?"FAILED":"COMPLETED",l.completedAt=new Date},1e3),o}async function J(t,o){const l=o||T.selectedProject?.projectId;if(!l)throw new Error("No project selected");const u=`batch-delete-topics-${Date.now()}`,m={id:u,type:"DELETE_TOPICS",status:"PENDING",items:t,progress:0,errors:[],createdAt:new Date};return b.value.set(u,m),setTimeout(async()=>{m.status="RUNNING";for(let s=0;s<t.length;s++)try{await U(t[s],l),m.progress=(s+1)/t.length*100}catch(e){m.errors.push({code:500,message:e.message,details:[t[s]],timestamp:new Date})}m.status=m.errors.length>0?"FAILED":"COMPLETED",m.completedAt=new Date},1e3),u}function Z(t){h.value=t,d.value&&S(t.name,t.projectId)}function X(){h.value=null}function _(t){Object.assign(x.value,t)}function Y(){x.value={projectId:"",namePattern:"",labels:{},states:[],dateRange:void 0}}function q(t){Object.assign(I.value,t)}function ee(){d.value=!d.value}function oe(t){return b.value.get(t)}function ne(t){b.value.delete(t)}function te(){b.value.clear()}function ue(t,o){const l=o||T.selectedProject?.projectId;if(!l)return;const u=t.startsWith("projects/")?t:`projects/${l}/topics/${t}`;return n.value.find(m=>m.fullName===u)}function ae(t,o){const l=o||T.selectedProject?.projectId;if(!l)return;const u=t.startsWith("projects/")?t:`projects/${l}/topics/${t}`;return j.value.get(u)}function ie(){p.value.clear(),j.value.clear()}function H(t){n.value=n.value.filter(o=>o.projectId!==t);for(const[o]of p.value)o.includes(`projects/${t}/`)&&p.value.delete(o);for(const[o]of j.value)o.includes(`projects/${t}/`)&&j.value.delete(o);h.value?.projectId===t&&(h.value=null),i.value.error=null}function de(){n.value=[],h.value=null,j.value.clear(),x.value={projectId:"",namePattern:"",labels:{},states:[],dateRange:void 0},I.value={pageSize:50,pageToken:void 0,orderBy:"name",filter:""},b.value.clear(),p.value.clear(),i.value={state:"idle",error:null,lastUpdated:null}}function G(t,o){const l=new Date,u=o?.start||new Date(l.getTime()-1440*60*1e3),m=o?.end||l,s=50,e=(m.getTime()-u.getTime())/s,r=[];for(let v=0;v<=s;v++){const ye=new Date(u.getTime()+v*e),ce=Math.floor(Math.random()*t),$=Math.sin(v*.1)*(t*.3),z=Math.max(0,ce+$);r.push({timestamp:ye,value:z})}return r}return{state:i,topics:n,selectedTopic:h,topicMetrics:j,filters:x,pagination:I,batchOperations:b,realtimeUpdates:d,currentProjectTopics:c,filteredTopics:g,topicStats:M,isLoading:D,hasError:R,activeBatchOperations:w,fetchTopics:O,fetchTopic:B,createTopic:E,updateTopic:W,deleteTopic:U,fetchTopicMetrics:S,createBatchTopics:K,deleteBatchTopics:J,selectTopic:Z,clearSelectedTopic:X,updateFilters:_,clearFilters:Y,updatePagination:q,toggleRealtimeUpdates:ee,getBatchOperation:oe,clearBatchOperation:ne,clearAllBatchOperations:te,getTopicByName:ue,getTopicMetrics:ae,clearCache:ie,clearProjectData:H,reset:de}}),Ue={class:"space-y-2"},ze={class:"flex-1"},Le=["value","onInput"],Fe={class:"flex-1"},Re=["value","onInput"],Je={class:"flex justify-center sm:justify-start"},Ge=["onClick"],We=fe({__name:"TemplateVariableInput",props:{variables:{}},emits:["update:variables"],setup(T,{emit:i}){const n=T,h=i,j=(b,d,p)=>{const c=[...n.variables];c[b]={...c[b],[d]:p},h("update:variables",c)},x=()=>{h("update:variables",[...n.variables,{name:"",value:""}])},I=b=>{if(n.variables.length>1){const d=n.variables.filter((p,c)=>c!==b);h("update:variables",d)}else h("update:variables",[{name:"",value:""}])};return(b,d)=>(y(),k("div",Ue,[(y(!0),k(re,null,be(b.variables,(p,c)=>(y(),k("div",{key:c,class:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3"},[a("div",ze,[a("input",{value:p.name,onInput:g=>j(c,"name",g.target.value),type:"text",placeholder:"Variable name (e.g., userId)",class:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-purple-500 focus:ring-purple-500 text-sm px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500"},null,40,Le)]),a("div",Fe,[a("input",{value:p.value,onInput:g=>j(c,"value",g.target.value),type:"text",placeholder:"Variable value",class:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-purple-500 focus:ring-purple-500 text-sm px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500"},null,40,Re)]),a("div",Je,[a("button",{onClick:g=>I(c),class:"p-2 text-gray-400 hover:text-red-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",title:"Remove variable"},[C(A(ke),{class:"h-4 w-4"})],8,Ge)])]))),128)),a("button",{onClick:x,class:"w-full flex items-center justify-center px-3 py-2 border border-dashed border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 hover:border-purple-300 dark:hover:border-purple-600 bg-white dark:bg-gray-800 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors"},[C(A(je),{class:"h-4 w-4 mr-2"}),d[0]||(d[0]=P(" Add Template Variable ",-1))])]))}}),Ke={class:"space-y-2"},qe={class:"flex-1"},He=["value","onInput"],Qe={class:"flex-1"},Ze=["value","onInput"],Xe={class:"flex justify-center sm:justify-start"},Ye=["onClick"],et=fe({__name:"MessageAttributeInput",props:{attributes:{}},emits:["update:attributes"],setup(T,{emit:i}){const n=T,h=i,j=(b,d,p)=>{const c=[...n.attributes];c[b]={...c[b],[d]:p},h("update:attributes",c)},x=()=>{h("update:attributes",[...n.attributes,{key:"",value:""}])},I=b=>{if(n.attributes.length>1){const d=n.attributes.filter((p,c)=>c!==b);h("update:attributes",d)}else h("update:attributes",[{key:"",value:""}])};return(b,d)=>(y(),k("div",Ke,[(y(!0),k(re,null,be(b.attributes,(p,c)=>(y(),k("div",{key:c,class:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3"},[a("div",qe,[a("input",{value:p.key,onInput:g=>j(c,"key",g.target.value),type:"text",placeholder:"Attribute key (e.g., eventType)",class:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500"},null,40,He)]),a("div",Qe,[a("input",{value:p.value,onInput:g=>j(c,"value",g.target.value),type:"text",placeholder:"Attribute value",class:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500"},null,40,Ze)]),a("div",Xe,[a("button",{onClick:g=>I(c),class:"p-2 text-gray-400 hover:text-red-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",title:"Remove attribute"},[C(A(ke),{class:"h-4 w-4"})],8,Ye)])]))),128)),a("button",{onClick:x,class:"w-full flex items-center justify-center px-3 py-2 border border-dashed border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:border-green-300 dark:hover:border-green-600 bg-white dark:bg-gray-800 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors"},[C(A(je),{class:"h-4 w-4 mr-2"}),d[0]||(d[0]=P(" Add Message Attribute ",-1))])]))}}),tt={class:"space-y-6 sm:space-y-8"},at={class:"space-y-3 sm:space-y-4"},st={class:"text-base sm:text-lg font-medium text-gray-900 dark:text-white flex items-center"},rt={class:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 sm:p-4 border border-gray-200 dark:border-gray-700"},lt={class:"relative"},ot={class:"flex items-center justify-between"},nt={class:"flex items-center min-w-0"},ut={class:"truncate"},it={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md shadow-lg"},dt={key:0,class:"p-2 border-b border-gray-200 dark:border-gray-600"},ct={class:"relative"},mt={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},pt={class:"max-h-48 overflow-auto"},vt={key:0,class:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400"},gt=["onClick"],ft={class:"flex items-center"},bt={class:"truncate"},yt={class:"space-y-3 sm:space-y-4"},ht={class:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 sm:p-4 border border-gray-200 dark:border-gray-700"},xt={class:"space-y-3 sm:space-y-4"},wt={class:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 sm:p-4 border border-gray-200 dark:border-gray-700"},kt={class:"space-y-3 sm:space-y-4"},jt={class:"space-y-3"},Tt={class:"relative"},It={class:"absolute bottom-2 sm:bottom-3 right-2 sm:right-3 flex flex-col sm:flex-row items-end sm:items-center sm:space-x-2 text-xs text-gray-500 dark:text-gray-400 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-lg px-2 py-1"},_t={class:"flex flex-col sm:flex-row sm:items-start sm:justify-between bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 gap-3 sm:gap-0"},$t={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"},Ct={class:"flex items-center"},Mt={key:0,class:"flex items-center text-xs text-green-600 dark:text-green-400"},Nt={key:1,class:"flex items-center text-xs text-red-600 dark:text-red-400"},St={class:"flex flex-col-reverse gap-3 sm:flex-row sm:justify-end"},Pt=["disabled"],At={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Et=["disabled"],Vt={key:0,class:"absolute right-0 bottom-full mb-1 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-600 z-50"},Dt={class:"py-1"},Ot=["disabled"],Bt={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ut=["disabled"],zt={key:0,class:"absolute right-0 bottom-full mb-1 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-600 z-50"},Lt={class:"py-1"},Ft={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},Qt=fe({__name:"PublishMessageModal",props:{modelValue:{type:Boolean},topicName:{},projectId:{},initialTemplate:{}},emits:["update:modelValue","message-published"],setup(T,{emit:i}){const n=T,h=i,j=Ae(),x=Be(),I=Ne(),b=N({get:()=>n.modelValue,set:s=>h("update:modelValue",s)}),d=f(""),p=f([{key:"",value:""}]),c=f([{name:"",value:""}]),g=f(!0),M=f(1),D=f(!1),R=f(!1),w=f(""),O=f(!1),B=f(""),E=f(!1),W=f(!1),U=f(""),S=f(""),K=f(!1),J=f(!1),Z=f(),X=f(),_=N(()=>{if(!g.value||!d.value.trim())return null;try{return JSON.parse(d.value),null}catch{return"Invalid JSON format"}}),Y=N(()=>!!n.initialTemplate?.originalTemplate),q=N(()=>x.topics.filter(r=>r.projectId===n.projectId).map(r=>r.name)),ee=N(()=>{if(!B.value.trim())return q.value;const s=B.value.toLowerCase();return q.value.filter(e=>e.toLowerCase().includes(s))}),oe=N(()=>{const s=[];return s.push({label:"Publish Message",handler:ae,variant:"primary",loading:E.value,disabled:!d.value.trim()||!w.value||g.value&&!!_.value||E.value}),s.push({label:"Save as Template",handler:H,variant:"secondary",disabled:!d.value.trim()||!w.value||g.value&&!!_.value}),s}),ne=N(()=>[{label:"Cancel",handler:o,variant:"secondary"},{label:"Save Template",handler:G,variant:"primary",loading:K.value,disabled:!U.value.trim()||K.value}]),te=async()=>{if(w.value=n.topicName,n.projectId)try{await x.fetchTopics(n.projectId)}catch(s){console.error("Failed to load topics:",s)}if(n.initialTemplate){d.value=n.initialTemplate.data,p.value=Object.entries(n.initialTemplate.attributes).map(([s,e])=>({key:s,value:e})),p.value.length===0&&(p.value=[{key:"",value:""}]),c.value=Object.entries(n.initialTemplate.variables).map(([s,e])=>({name:s,value:e})),c.value.length===0&&(c.value=[{name:"",value:""}]);try{JSON.parse(n.initialTemplate.data),g.value=!0}catch{g.value=!1}}},ue=s=>{if(!s.trim())return s;let e=s;return c.value.forEach(r=>{if(r.name.trim()&&r.value.trim()){const v=new RegExp(`{{\\s*\\.${r.name.trim()}\\s*}}`,"g");e=e.replace(v,r.value.trim())}}),e},ae=async()=>{if(d.value.trim()){E.value=!0;try{const s=ue(d.value),e={};if(p.value.forEach(r=>{r.key.trim()&&r.value.trim()&&(e[r.key.trim()]=r.value.trim())}),M.value>1){for(let r=0;r<M.value;r++)await le.publishMessage(n.projectId,w.value,{data:btoa(s),attributes:e}),r<M.value-1&&await new Promise(v=>setTimeout(v,100));I.success(`Published ${M.value} messages successfully!`,{timeout:3e3}),h("message-published")}else await le.publishMessage(n.projectId,w.value,{data:btoa(s),attributes:e}),I.success("Message published successfully!",{timeout:2e3}),h("message-published")}catch(s){I.error(s.message||"Failed to publish message",{timeout:4e3})}finally{E.value=!1}}},ie=s=>{w.value=s,O.value=!1,B.value=""},H=()=>{!d.value.trim()||g.value&&_.value||(U.value="",S.value="",W.value=!0)},de=async()=>{if(!d.value.trim()||g.value&&_.value)return;const s=n.initialTemplate?.originalTemplate;if(s){J.value=!0;try{const e={};p.value.forEach(v=>{v.key.trim()&&v.value.trim()&&(e[v.key.trim()]=v.value.trim())});const r={};c.value.forEach(v=>{v.name.trim()&&v.value.trim()&&(r[v.name.trim()]=v.value.trim())}),await j.updateTemplate(s.id,{data:d.value,attributes:e,variables:r,topicName:w.value}),I.success(`Template "${s.name}" has been updated successfully`,{timeout:3e3})}catch(e){I.error(e.message||"Failed to update template",{timeout:4e3})}finally{J.value=!1}}},G=async()=>{const s=U.value.trim();if(!s){S.value="Template name is required";return}if(j.templates.some(e=>e.name===s)){S.value="A template with this name already exists";return}K.value=!0;try{const e={};p.value.forEach(v=>{v.key.trim()&&v.value.trim()&&(e[v.key.trim()]=v.value.trim())});const r={};c.value.forEach(v=>{v.name.trim()&&v.value.trim()&&(r[v.name.trim()]=v.value.trim())}),await j.saveTemplate({name:s,data:d.value,attributes:e,variables:r,topicName:w.value,projectId:n.projectId}),I.success(`Template "${s}" has been saved successfully`,{timeout:3e3}),o()}catch(e){I.error(e.message||"Failed to save template",{timeout:4e3})}finally{K.value=!1}},t=()=>{b.value=!1,u()},o=()=>{W.value=!1,U.value="",S.value="",K.value=!1},l=()=>{S.value&&(S.value="")},u=()=>{d.value="",p.value=[{key:"",value:""}],c.value=[{name:"",value:""}],g.value=!1,M.value=1,D.value=!1,R.value=!1,w.value=n.topicName};me(()=>n.modelValue,async s=>{s&&await te()},{immediate:!0}),me(()=>W.value,async s=>{s&&(await new Promise(e=>setTimeout(e,100)),Z.value?.focus())});const m=s=>{if(O.value){const e=s.target,r=e.closest(".relative");(!r||!r.contains(e))&&(O.value=!1,B.value="")}};return me(()=>O.value,async s=>{s&&q.value.length>5&&(await new Promise(e=>setTimeout(e,100)),X.value?.focus())}),Ie(async()=>{await te(),document.addEventListener("click",m)}),_e(()=>{document.removeEventListener("click",m)}),(s,e)=>(y(),k(re,null,[C(we,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=r=>b.value=r),title:"Publish Message",size:"5xl",actions:oe.value,onClose:t},{footer:pe(()=>[a("div",St,[a("div",{class:L(["relative inline-flex rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-0 dark:focus-within:ring-offset-0 transition-colors w-full sm:w-auto",{"opacity-50 cursor-not-allowed":!d.value.trim()||!w.value||g.value&&!!_.value||J.value}])},[a("button",{onClick:e[7]||(e[7]=r=>Y.value?de():H()),disabled:!d.value.trim()||!w.value||g.value&&!!_.value||J.value,class:"flex-1 inline-flex justify-center items-center px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 focus:outline-none disabled:cursor-not-allowed min-w-0"},[J.value?(y(),k("svg",At,[...e[24]||(e[24]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):V("",!0),P(" "+F(Y.value?"Save":"Save as Template"),1)],8,Pt),e[26]||(e[26]=a("div",{class:"w-px bg-gray-300 dark:bg-gray-600"},null,-1)),a("button",{onClick:e[8]||(e[8]=r=>R.value=!R.value),disabled:!d.value.trim()||!w.value||g.value&&!!_.value||J.value,class:"inline-flex items-center justify-center px-2 sm:px-2 py-2 text-gray-700 dark:text-gray-300 focus:outline-none disabled:cursor-not-allowed flex-shrink-0"},[(y(),k("svg",{class:L(["h-4 w-4 transition-transform",{"rotate-180":R.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[25]||(e[25]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,Et),R.value?(y(),k("div",Vt,[a("div",Dt,[a("button",{onClick:e[9]||(e[9]=r=>{H(),R.value=!1}),class:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-700"}," Save as Template ")])])):V("",!0)],2),a("div",{class:L(["relative inline-flex rounded-md bg-blue-600 hover:bg-blue-700 focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-0 transition-colors w-full sm:w-auto",{"opacity-50 cursor-not-allowed":!d.value.trim()||!w.value||g.value&&!!_.value||E.value}])},[a("button",{onClick:ae,disabled:!d.value.trim()||!w.value||g.value&&!!_.value||E.value,class:"flex-1 inline-flex justify-center items-center px-3 sm:px-4 py-2 text-sm font-medium text-white focus:outline-none disabled:cursor-not-allowed min-w-0"},[E.value?(y(),k("svg",Bt,[...e[27]||(e[27]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):V("",!0),P(" "+F(M.value>1?`Publish ${M.value} Messages`:"Publish Message"),1)],8,Ot),e[29]||(e[29]=a("div",{class:"w-px bg-blue-500"},null,-1)),a("button",{onClick:e[10]||(e[10]=r=>D.value=!D.value),disabled:!d.value.trim()||!w.value||g.value&&!!_.value||E.value,class:"inline-flex items-center justify-center px-2 sm:px-2 py-2 text-white focus:outline-none disabled:cursor-not-allowed flex-shrink-0"},[(y(),k("svg",{class:L(["h-4 w-4 transition-transform",{"rotate-180":D.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[28]||(e[28]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,Ut),D.value?(y(),k("div",zt,[a("div",Lt,[a("button",{onClick:e[11]||(e[11]=r=>{M.value=1,D.value=!1}),class:L(["w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-700",{"bg-gray-100 dark:bg-gray-700":M.value===1}])}," Publish 1 Message ",2),a("button",{onClick:e[12]||(e[12]=r=>{M.value=10,D.value=!1}),class:L(["w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-700",{"bg-gray-100 dark:bg-gray-700":M.value===10}])}," Publish 10 Messages ",2)])])):V("",!0)],2)])]),default:pe(()=>[a("div",tt,[a("section",at,[a("div",null,[a("h4",st,[C(A(ge),{class:"h-4 w-4 sm:h-5 sm:w-5 text-blue-500 mr-2 flex-shrink-0"}),e[16]||(e[16]=P(" Target Topic ",-1))]),e[17]||(e[17]=a("p",{class:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1"}," Select the topic where this message will be published ",-1))]),a("div",rt,[a("div",lt,[a("button",{onClick:e[0]||(e[0]=r=>O.value=!O.value),type:"button",class:L(["w-full px-3 py-2 text-left border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"text-gray-500 dark:text-gray-400":!w.value}])},[a("div",ot,[a("div",nt,[C(A(ge),{class:"h-4 w-4 text-blue-500 mr-2 shrink-0"}),a("span",ut,F(w.value||"Select a topic..."),1)]),C(A(Oe),{class:"h-4 w-4 text-gray-400 shrink-0"})])],2),O.value?(y(),k("div",it,[q.value.length>5?(y(),k("div",dt,[a("div",ct,[a("div",mt,[C(A(Se),{class:"h-4 w-4 text-gray-400"})]),se(a("input",{ref_key:"topicSearchInput",ref:X,"onUpdate:modelValue":e[1]||(e[1]=r=>B.value=r),type:"text",placeholder:"Search topics...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm",onClick:e[2]||(e[2]=he(()=>{},["stop"]))},null,512),[[ve,B.value]])])])):V("",!0),a("div",pt,[ee.value.length===0?(y(),k("div",vt,F(B.value?"No topics match your search":"No topics available"),1)):V("",!0),(y(!0),k(re,null,be(ee.value,r=>(y(),k("button",{key:r,onClick:v=>ie(r),type:"button",class:L(["w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:bg-gray-50 dark:focus:bg-gray-600 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":w.value===r,"text-gray-900 dark:text-white":w.value!==r}])},[a("div",ft,[C(A(ge),{class:"h-4 w-4 text-blue-500 mr-2 shrink-0"}),a("span",bt,F(r),1),w.value===r?(y(),$e(A(Ve),{key:0,class:"h-4 w-4 text-blue-600 dark:text-blue-400 ml-auto shrink-0"})):V("",!0)])],10,gt))),128))])])):V("",!0)])])]),a("section",yt,[e[18]||(e[18]=a("div",{class:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2"},[a("div",null,[a("h4",{class:"text-base sm:text-lg font-medium text-gray-900 dark:text-white flex items-center"},[a("svg",{class:"h-4 w-4 sm:h-5 sm:w-5 text-purple-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})]),P(" Template Variables ")]),a("p",{class:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1"},[P(" Define variables to use in your message data with "),a("code",{class:"text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/20 px-1.5 py-0.5 rounded-md font-mono text-xs",textContent:"{{.variableName}}"}),P(" syntax ")])])],-1)),a("div",ht,[C(We,{variables:c.value,"onUpdate:variables":e[3]||(e[3]=r=>c.value=r)},null,8,["variables"])])]),a("section",xt,[e[19]||(e[19]=a("div",null,[a("h4",{class:"text-base sm:text-lg font-medium text-gray-900 dark:text-white flex items-center"},[a("svg",{class:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})]),P(" Message Attributes ")]),a("p",{class:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1"}," Add key-value pairs as message attributes ")],-1)),a("div",wt,[C(et,{attributes:p.value,"onUpdate:attributes":e[4]||(e[4]=r=>p.value=r)},null,8,["attributes"])])]),a("section",kt,[e[23]||(e[23]=a("div",{class:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-4"},[a("div",{class:"flex-1 min-w-0"},[a("h4",{class:"text-base sm:text-lg font-medium text-gray-900 dark:text-white flex items-center"},[a("svg",{class:"h-4 w-4 sm:h-5 sm:w-5 text-blue-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),P(" Message Data ")]),a("p",{class:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1"}," Enter your message data as JSON or plain text ")])],-1)),a("div",jt,[a("div",Tt,[se(a("textarea",{id:"message-data","onUpdate:modelValue":e[5]||(e[5]=r=>d.value=r),rows:"10",placeholder:"Enter JSON or plain text...",class:"block w-full rounded-xl border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm font-mono px-3 sm:px-4 py-2 sm:py-3 resize-vertical placeholder-gray-400 dark:placeholder-gray-500"},null,512),[[ve,d.value]]),a("div",It,[a("span",null,F(d.value.length)+" chars",1),e[20]||(e[20]=a("div",{class:"hidden sm:block w-px h-3 bg-gray-300 dark:bg-gray-600"},null,-1)),a("span",null,F(d.value.split(`
`).length)+" lines",1)])]),a("div",_t,[a("div",$t,[a("div",Ct,[se(a("input",{id:"format-json","onUpdate:modelValue":e[6]||(e[6]=r=>g.value=r),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"},null,512),[[Ce,g.value]]),e[21]||(e[21]=a("label",{for:"format-json",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," Validate and format as JSON ",-1))]),g.value&&!_.value&&d.value.trim()?(y(),k("div",Mt,[...e[22]||(e[22]=[a("svg",{class:"h-4 w-4 mr-1 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),P(" Valid JSON ",-1)])])):V("",!0),g.value&&_.value?(y(),k("div",Nt,[C(A(Pe),{class:"h-4 w-4 mr-1 flex-shrink-0"}),P(" "+F(_.value),1)])):V("",!0)])])])])])]),_:1},8,["modelValue","actions"]),C(we,{modelValue:W.value,"onUpdate:modelValue":e[15]||(e[15]=r=>W.value=r),title:"Save as Template",icon:A(De),"icon-color":"primary",size:"md","z-index":60,actions:ne.value,onClose:o},{default:pe(()=>[a("form",{onSubmit:he(G,["prevent"]),class:"space-y-4"},[a("div",null,[e[30]||(e[30]=a("label",{for:"template-name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Template Name ",-1)),se(a("input",{id:"template-name",ref_key:"templateNameInput",ref:Z,"onUpdate:modelValue":e[14]||(e[14]=r=>U.value=r),type:"text",placeholder:"Enter template name",class:L(["w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":S.value}]),onInput:l},null,34),[[ve,U.value]]),S.value?(y(),k("p",Ft,F(S.value),1)):V("",!0),e[31]||(e[31]=a("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Save your message configuration for future use ",-1))])],32)]),_:1},8,["modelValue","icon","actions"])],64))}});export{Qt as _,Be as u};
