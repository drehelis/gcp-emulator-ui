import{s as re,$ as le,r as u,f as y,w as oe,R as ie,x as r,O as l,Q as n,a1 as ne,F as e,u as d,I as i,H as L,y as U,G as m,L as x,E as p,K as b,D as de,Z as ce,_ as ue}from"./vendor-C_kCRdsv.js";import{u as pe}from"./messageTemplates-BIHD0qL0.js";import{u as ge,_ as me}from"./PublishMessageModal.vue_vue_type_script_setup_true_lang-DXzMVQZ7.js";import{u as xe,D as ve,z as F,A as H,x as K,g as Q}from"./index-CET3MO9v.js";import{_ as he}from"./BaseModal.vue_vue_type_script_setup_true_lang-CbCA5KVJ.js";import{_ as ye}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-BtIlvEIB.js";import{r as k}from"./DocumentDuplicateIcon-Bk0JYA52.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./pinia-B2SWLoi0.js";import"./query-BV4EBN_X.js";const fe={class:"space-y-6"},_e={key:0,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},ke={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},we={class:"text-center"},Te={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},De={class:"mt-4"},Ce={key:2,class:"space-y-6"},$e={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},je={class:"px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Ve={class:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0"},Ne={class:"text-lg font-medium text-gray-900 dark:text-white"},Ae={class:"flex items-center space-x-3"},Me=["disabled"],Se={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Ie={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ee=["onClick"],Oe={class:"space-y-3"},Le={class:"flex items-start justify-between"},Ue={class:"flex items-start space-x-3 min-w-0 flex-1"},Fe={class:"min-w-0 flex-1"},Pe={class:"text-sm font-medium text-gray-900 dark:text-white"},Re={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},ze={class:"flex items-center space-x-1 ml-2"},Be=["onClick"],qe=["onClick"],Ge=["onClick"],He={class:"flex items-center text-sm text-gray-600 dark:text-gray-300"},Ke={class:"space-y-2"},Qe={key:0,class:"flex items-center flex-wrap gap-x-3 gap-y-1"},We={class:"font-medium text-gray-900 dark:text-white"},Ye={class:"text-gray-500 dark:text-gray-400 ml-1"},Ze={key:1,class:"flex items-center flex-wrap gap-x-3 gap-y-1"},Je={class:"font-medium text-gray-900 dark:text-white"},Xe={class:"text-gray-500 dark:text-gray-400 ml-1"},et={key:2,class:"flex items-center flex-wrap gap-1"},tt={class:"text-xs text-gray-400 dark:text-gray-500"},st=["onClick"],at={class:"col-span-4 min-w-0"},rt={class:"flex items-start space-x-3"},lt={class:"min-w-0 flex-1"},ot={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},it={key:0,class:"text-xs text-gray-500 dark:text-gray-400 truncate"},nt={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},dt={class:"col-span-2 min-w-0"},ct={class:"flex items-center text-sm text-gray-600 dark:text-gray-300"},ut={class:"truncate"},pt={class:"col-span-5 min-w-0"},gt={class:"space-y-1"},mt={key:0,class:"flex items-center flex-wrap gap-x-3 gap-y-1"},xt={class:"font-medium text-gray-900 dark:text-white"},vt={class:"text-gray-500 dark:text-gray-400 ml-1"},ht={key:1,class:"flex items-center flex-wrap gap-x-3 gap-y-1"},yt={class:"font-medium text-gray-900 dark:text-white"},bt={class:"text-gray-500 dark:text-gray-400 ml-1"},ft={key:2,class:"flex items-center flex-wrap gap-1"},_t={class:"col-span-1 text-right"},kt={class:"flex items-center justify-end space-x-1"},wt=["onClick"],Tt=["onClick"],Dt=["onClick"],Ct={key:3,class:"space-y-6"},$t={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},jt={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Vt={class:"flex items-center justify-between"},Nt={class:"flex items-center space-x-3"},At=["disabled"],Mt={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},St={class:"text-center py-12"},It={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},Et={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ot=re({__name:"MessageTemplatesView",setup(Lt){const W=le(),v=pe(),Y=ge(),V=xe(),N=u(!1),A=u(!1),f=u(null),M=u(!1),S=u(!1),w=u(null),g=u(""),h=u(""),T=u(!1),P=u(null),_=u({topicName:"",projectId:"",initialTemplate:null}),D=y(()=>W.params.projectId),C=y(()=>v.templates.filter(a=>a.projectId===D.value)),Z=y(()=>{const a=new Set;return C.value.forEach(s=>{a.add(s.topicName)}),{total:C.value.length,byTopic:a.size,withVariables:C.value.filter(s=>Object.keys(s.variables).length>0).length,withAttributes:C.value.filter(s=>Object.keys(s.attributes).length>0).length}}),$=y(()=>v.isLoading),J=y(()=>v.hasError),E=y(()=>[...C.value].sort((a,s)=>s.updatedAt.getTime()-a.updatedAt.getTime())),X=y(()=>[{label:"Cancel",handler:O,variant:"secondary"},{label:"Duplicate Template",handler:z,variant:"primary",loading:T.value,disabled:!g.value.trim()||T.value}]);async function j(){try{await Promise.all([v.loadTemplates(),Y.fetchTopics(D.value)])}catch(a){console.error("Failed to load data:",a)}}async function I(a){_.value={topicName:a.topicName,projectId:a.projectId,initialTemplate:{data:a.data,attributes:{...a.attributes},variables:{...a.variables},originalTemplate:a}},N.value=!0}function R(a){w.value=a,g.value=`${a.name} (Copy)`,h.value="",S.value=!0,setTimeout(()=>{P.value?.focus()},100)}async function z(){if(w.value){if(!g.value.trim()){h.value="Template name is required";return}try{T.value=!0,await v.duplicateTemplate(w.value.id,g.value.trim()),V.showToast({type:"success",title:"Template Duplicated",message:`Template "${g.value}" has been created`}),O()}catch(a){V.showToast({type:"error",title:"Duplication Failed",message:a.message})}finally{T.value=!1}}}function O(){S.value=!1,w.value=null,g.value="",h.value="",T.value=!1}function ee(){h.value=""}function B(a){f.value=a,A.value=!0}async function te(){if(f.value)try{M.value=!0,await v.deleteTemplate(f.value.id),V.showToast({type:"success",title:"Template Deleted",message:`Template "${f.value.name}" has been deleted`}),q()}catch(a){V.showToast({type:"error",title:"Deletion Failed",message:a.message})}finally{M.value=!1}}function q(){A.value=!1,f.value=null,M.value=!1}function se(a){a||(_.value.initialTemplate=null)}function ae(){N.value=!1,_.value.initialTemplate=null}function G(a){const t=new Date().getTime()-a.getTime(),o=Math.floor(t/(1e3*60*60*24));return o===0?"Today":o===1?"Yesterday":o<7?`${o} days ago`:a.toLocaleDateString()}return oe(()=>D.value,()=>{D.value&&j()},{immediate:!0}),ie(()=>{D.value&&j()}),(a,s)=>(l(),r("div",fe,[$.value?(l(),r("div",_e,[...s[4]||(s[4]=[ne('<div class="animate-pulse" data-v-1e315b48><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4" data-v-1e315b48></div><div class="space-y-3" data-v-1e315b48><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded" data-v-1e315b48></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6" data-v-1e315b48></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/6" data-v-1e315b48></div></div></div>',1)])])):J.value?(l(),r("div",ke,[e("div",we,[n(d(ve),{class:"mx-auto h-12 w-12 text-red-400"}),s[6]||(s[6]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Error Loading Templates",-1)),e("p",Te,i(d(v).state.error),1),e("div",De,[e("button",{onClick:j,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors"},[n(d(F),{class:"h-4 w-4 mr-2"}),s[5]||(s[5]=L(" Retry ",-1))])])])])):E.value.length>0?(l(),r("div",Ce,[e("div",$e,[e("div",je,[e("div",Ve,[e("h2",Ne," Templates ("+i(Z.value.total)+") ",1),e("div",Ae,[e("button",{onClick:j,disabled:$.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"},[n(d(F),{class:U(["h-4 w-4 mr-2",{"animate-spin":$.value}])},null,8,["class"]),s[7]||(s[7]=L(" Refresh ",-1))],8,Me)])])])]),e("div",Se,[e("div",Ie,[(l(!0),r(m,null,x(E.value,t=>(l(),r("div",{key:t.id,class:"group block sm:hidden px-4 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:o=>I(t)},[e("div",Oe,[e("div",Le,[e("div",Ue,[n(d(k),{class:"h-5 w-5 text-purple-500 mt-0.5 shrink-0"}),e("div",Fe,[e("div",Pe,i(t.name),1),t.description?(l(),r("div",Re,i(t.description),1)):p("",!0)])]),e("div",ze,[e("button",{onClick:b(o=>I(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all",title:"Use template"},[n(d(H),{class:"w-4 h-4"})],8,Be),e("button",{onClick:b(o=>R(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition-all",title:"Duplicate"},[n(d(k),{class:"w-4 h-4"})],8,qe),e("button",{onClick:b(o=>B(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all",title:"Delete"},[n(d(K),{class:"w-4 h-4"})],8,Ge)])]),e("div",He,[n(d(Q),{class:"w-4 h-4 mr-2 text-gray-400 shrink-0"}),e("span",null,i(t.topicName),1)]),e("div",Ke,[Object.keys(t.variables).length>0?(l(),r("div",Qe,[s[8]||(s[8]=e("span",{class:"text-xs text-purple-600 dark:text-purple-400 font-medium"},"Variables:",-1)),(l(!0),r(m,null,x(t.variables,(o,c)=>(l(),r("span",{key:c,class:"text-xs"},[e("span",We,i(c),1),e("span",Ye,i(o),1)]))),128))])):p("",!0),Object.keys(t.attributes).length>0?(l(),r("div",Ze,[s[9]||(s[9]=e("span",{class:"text-xs text-blue-600 dark:text-blue-400 font-medium"},"Attributes:",-1)),(l(!0),r(m,null,x(t.attributes,(o,c)=>(l(),r("span",{key:c,class:"text-xs"},[e("span",Je,i(c),1),e("span",Xe,i(o),1)]))),128))])):p("",!0),t.tags&&t.tags.length>0?(l(),r("div",et,[s[10]||(s[10]=e("span",{class:"text-xs text-green-600 dark:text-green-400 font-medium"},"Tags:",-1)),(l(!0),r(m,null,x(t.tags,o=>(l(),r("span",{key:o,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"},i(o),1))),128))])):p("",!0)]),e("div",tt,i(G(t.updatedAt>t.createdAt?t.updatedAt:t.createdAt)),1)])],8,Ee))),128)),(l(!0),r(m,null,x(E.value,t=>(l(),r("div",{key:`desktop-${t.id}`,class:"group hidden sm:grid grid-cols-12 gap-4 px-6 py-4 items-center hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:o=>I(t)},[e("div",at,[e("div",rt,[n(d(k),{class:"h-5 w-5 text-purple-500 mt-0.5 shrink-0"}),e("div",lt,[e("div",ot,i(t.name),1),t.description?(l(),r("div",it,i(t.description),1)):p("",!0),e("div",nt,i(G(t.updatedAt>t.createdAt?t.updatedAt:t.createdAt)),1)])])]),e("div",dt,[e("div",ct,[n(d(Q),{class:"w-4 h-4 mr-2 text-gray-400 shrink-0"}),e("span",ut,i(t.topicName),1)])]),e("div",pt,[e("div",gt,[Object.keys(t.variables).length>0?(l(),r("div",mt,[s[11]||(s[11]=e("span",{class:"text-xs text-purple-600 dark:text-purple-400 font-medium"},"Variables:",-1)),(l(!0),r(m,null,x(t.variables,(o,c)=>(l(),r("span",{key:c,class:"text-xs"},[e("span",xt,i(c),1),e("span",vt,i(o),1)]))),128))])):p("",!0),Object.keys(t.attributes).length>0?(l(),r("div",ht,[s[12]||(s[12]=e("span",{class:"text-xs text-blue-600 dark:text-blue-400 font-medium"},"Attributes:",-1)),(l(!0),r(m,null,x(t.attributes,(o,c)=>(l(),r("span",{key:c,class:"text-xs"},[e("span",yt,i(c),1),e("span",bt,i(o),1)]))),128))])):p("",!0),t.tags&&t.tags.length>0?(l(),r("div",ft,[s[13]||(s[13]=e("span",{class:"text-xs text-green-600 dark:text-green-400 font-medium"},"Tags:",-1)),(l(!0),r(m,null,x(t.tags,o=>(l(),r("span",{key:o,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"},i(o),1))),128))])):p("",!0)])]),e("div",_t,[e("div",kt,[e("button",{onClick:b(o=>I(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all",title:"Use template"},[n(d(H),{class:"w-4 h-4"})],8,wt),e("button",{onClick:b(o=>R(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition-all",title:"Duplicate"},[n(d(k),{class:"w-4 h-4"})],8,Tt),e("button",{onClick:b(o=>B(t),["stop"]),class:"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all",title:"Delete"},[n(d(K),{class:"w-4 h-4"})],8,Dt)])])],8,st))),128))])])])):(l(),r("div",Ct,[e("div",$t,[e("div",jt,[e("div",Vt,[s[15]||(s[15]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Templates (0) ",-1)),e("div",Nt,[e("button",{onClick:j,disabled:$.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"},[n(d(F),{class:U(["h-4 w-4 mr-2",{"animate-spin":$.value}])},null,8,["class"]),s[14]||(s[14]=L(" Refresh ",-1))],8,At)])])])]),e("div",Mt,[e("div",St,[n(d(k),{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-600"}),s[16]||(s[16]=e("h3",{class:"mt-4 text-lg font-medium text-gray-900 dark:text-white"}," No templates yet ",-1)),s[17]||(s[17]=e("p",{class:"mt-2 text-gray-600 dark:text-gray-400"},' Create templates by using "Save as Template" when publishing messages to topics ',-1))])])])),n(he,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=t=>S.value=t),title:"Duplicate Template",icon:d(k),"icon-color":"primary",size:"md",actions:X.value,onClose:O},{default:de(()=>[e("form",{onSubmit:b(z,["prevent"]),class:"space-y-4"},[e("div",null,[s[18]||(s[18]=e("label",{for:"duplicate-template-name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Template Name ",-1)),ce(e("input",{id:"duplicate-template-name",ref_key:"duplicateTemplateNameInput",ref:P,"onUpdate:modelValue":s[0]||(s[0]=t=>g.value=t),type:"text",placeholder:"Enter name for the duplicated template...",class:U(["w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":h.value}]),onInput:ee},null,34),[[ue,g.value]]),h.value?(l(),r("p",It,i(h.value),1)):p("",!0),e("p",Et,' This will create a copy of "'+i(w.value?.name)+'" with all its data, attributes, and variables. ',1)])],32)]),_:1},8,["modelValue","icon","actions"]),n(ye,{modelValue:A.value,"onUpdate:modelValue":s[2]||(s[2]=t=>A.value=t),title:"Delete Template",message:`Are you sure you want to delete the template '${f.value?.name}'?`,"confirm-label":"Delete Template","is-loading":M.value,details:{title:"What will happen:",description:"The template will be permanently deleted from your saved templates."},onConfirm:te,onCancel:q},null,8,["modelValue","message","is-loading"]),n(me,{modelValue:N.value,"onUpdate:modelValue":[s[3]||(s[3]=t=>N.value=t),se],"topic-name":_.value.topicName,"project-id":_.value.projectId,"initial-template":_.value.initialTemplate,onMessagePublished:ae},null,8,["modelValue","topic-name","project-id","initial-template"])]))}}),Qt=be(Ot,[["__scopeId","data-v-1e315b48"]]);export{Qt as default};
