import{x as i,O as l,F as e,s as te,r as h,f as L,A as W,D as ge,Q as p,u as y,I as d,E as z,y as T,H as I,G as F,L as R,K as J,$ as me,w as G,R as pe,a1 as ye,n as xe}from"./vendor-C_kCRdsv.js";import{a as be}from"./focusUtils-B2fA3ttj.js";import{i as X,B as N,u as he,y as ke,z as Q,v as fe,r as ve,g as we,C as _e,x as $e,s as E}from"./index-CET3MO9v.js";import{_ as Te}from"./BaseModal.vue_vue_type_script_setup_true_lang-CbCA5KVJ.js";import{r as ee,_ as Ce}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-BtIlvEIB.js";import"./pinia-B2SWLoi0.js";import"./query-BV4EBN_X.js";function De(O,V){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])}const Se={class:"space-y-6"},Ae={class:"flex flex-col space-y-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg sm:flex-row sm:items-center sm:justify-between sm:space-y-0"},Me={class:"flex items-center space-x-3 min-w-0"},Pe={class:"min-w-0"},je={class:"text-lg font-medium text-gray-900 dark:text-white truncate"},Ve={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},Ie={class:"flex items-center justify-between space-x-3 sm:justify-end"},Be={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300"},Ee=["disabled"],ze={key:0,class:"hidden sm:inline"},Fe={key:1,class:"sm:hidden"},Le={key:2,class:"flex items-center"},Re={key:0,class:"space-y-4"},Oe={class:"flex items-center justify-between"},Ue={class:"text-sm font-medium text-gray-900 dark:text-white"},He=["disabled"],Ke={class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg max-h-96 overflow-y-auto"},qe={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ge={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},Qe=["onClick"],We={class:"px-3 py-2 whitespace-nowrap"},Je={class:"flex items-center space-x-2"},Xe={class:"text-xs font-mono text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded"},Ye={class:"px-3 py-2 max-w-xs"},Ze={class:"text-xs font-mono text-gray-900 dark:text-gray-200 truncate"},Ne={key:0},et={key:1,class:"italic text-gray-400"},tt={class:"px-3 py-2 whitespace-nowrap"},st={class:"text-xs text-gray-500 dark:text-gray-400"},at={class:"px-3 py-2 whitespace-nowrap"},ot={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"},rt={key:1,class:"text-xs text-gray-400"},nt={class:"px-3 py-2 whitespace-nowrap"},lt={class:"text-xs text-gray-500 dark:text-gray-400"},it={class:"px-3 py-2 whitespace-nowrap"},dt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300"},ct={key:1,class:"text-xs text-gray-400"},ut={class:"px-3 py-2 whitespace-nowrap text-right"},gt=["onClick","disabled"],mt={key:0,class:"bg-gray-50 dark:bg-gray-700/50"},pt={colspan:"7",class:"px-6 py-4 border-l-4 border-blue-500"},yt={class:"space-y-4"},xt={class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-md p-3 font-mono text-sm max-h-48 overflow-y-auto"},bt={key:0,class:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap break-all"},ht={key:1,class:"text-gray-400 dark:text-gray-500 italic"},kt={key:0},ft={class:"text-sm font-medium text-gray-700 dark:text-gray-300 block mb-2"},vt={class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-md p-3 space-y-2"},wt={class:"font-mono text-blue-600 dark:text-blue-400 min-w-0 flex-shrink-0 mr-3 font-medium"},_t={class:"font-mono text-gray-800 dark:text-gray-200 break-all"},$t={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm"},Tt={class:"text-gray-900 dark:text-white font-mono"},Ct={class:"text-gray-900 dark:text-white"},Dt={class:"text-gray-900 dark:text-white font-mono text-xs truncate"},St={key:1,class:"text-center py-12"},At=["disabled"],Mt={key:0},Pt={key:1,class:"flex items-center"},jt=te({__name:"SubscriptionMessagesModal",props:{modelValue:{type:Boolean},subscription:{},projectId:{},messages:{},isPulling:{type:Boolean},isAcknowledging:{type:Boolean}},emits:["update:modelValue","pull-messages","acknowledge-message","acknowledge-all"],setup(O,{emit:V}){const u=O,g=V,b=h(new Set),f=L({get:()=>u.modelValue,set:a=>g("update:modelValue",a)}),v=L(()=>{if(!u.subscription?.name)return"";const a=u.subscription.name.split("/");return a[a.length-1]}),C=()=>{g("update:modelValue",!1)},D=a=>{b.value.has(a)?b.value.delete(a):b.value.add(a)},w=a=>{try{return typeof a=="string"?window.atob(a):new TextDecoder("utf-8").decode(a)}catch{return"(invalid data)"}},P=a=>{const n=new Date().getTime()-a.getTime(),x=Math.floor(n/1e3),k=Math.floor(x/60),j=Math.floor(k/60),_=Math.floor(j/24);return x<60?`${x}s ago`:k<60?`${k}m ago`:j<24?`${j}h ago`:`${_}d ago`},S=a=>{if(!a)return"0 bytes";let o=0;return typeof a=="string"?o=Math.floor(a.length*3/4):o=a.byteLength,o<1024?`${o} bytes`:o<1024*1024?`${Math.round(o/1024)} KB`:`${Math.round(o/(1024*1024))} MB`};return(a,o)=>(l(),W(Te,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=n=>f.value=n),title:"Pull Messages",size:"full",onClose:C},{default:ge(()=>[e("div",Se,[e("div",Ae,[e("div",Me,[p(y(X),{class:"h-6 w-6 text-green-500 flex-shrink-0"}),e("div",Pe,[e("h3",je,d(v.value),1),e("p",Ve,d(a.subscription?.name),1)])]),e("div",Ie,[e("span",Be,d(a.messages.length)+" messages ",1),e("button",{onClick:o[0]||(o[0]=n=>a.$emit("pull-messages")),disabled:a.isPulling,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 sm:px-4"},[p(y(N),{class:T(["h-4 w-4 mr-1 sm:mr-2",{"animate-pulse":a.isPulling}])},null,8,["class"]),a.isPulling?z("",!0):(l(),i("span",ze,"Pull Messages")),a.isPulling?(l(),i("span",Le,[...o[4]||(o[4]=[e("span",{class:"hidden sm:inline"},"Pulling...",-1),e("span",{class:"sm:hidden"},"...",-1),e("span",{class:"ml-2 text-xs opacity-75 hidden sm:inline"},"(may take up to 3min)",-1)])])):(l(),i("span",Fe,"Pull"))],8,Ee)])]),a.messages.length>0?(l(),i("div",Re,[e("div",Oe,[e("h4",Ue," Messages ("+d(a.messages.length)+") ",1),e("button",{onClick:o[1]||(o[1]=n=>a.subscription?.name&&a.$emit("acknowledge-all",a.subscription.name)),disabled:a.isAcknowledging,class:"inline-flex items-center px-3 py-1.5 border border-green-300 dark:border-green-600 rounded-md text-xs font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50"},[p(y(ee),{class:T(["h-3 w-3 mr-1",{"animate-pulse":a.isAcknowledging}])},null,8,["class"]),I(" "+d(a.isAcknowledging?"Acknowledging...":"Acknowledge All"),1)],8,He)]),e("div",Ke,[e("table",qe,[o[11]||(o[11]=e("thead",{class:"bg-gray-50 dark:bg-gray-700 sticky top-0"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Message ID"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Data Preview"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Size"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Attributes"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Published"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Attempt"),e("th",{scope:"col",class:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Action")])],-1)),e("tbody",Ge,[(l(!0),i(F,null,R(a.messages,n=>(l(),i(F,{key:n.ackId},[e("tr",{onClick:x=>D(n.ackId),class:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer"},[e("td",We,[e("div",Je,[(l(),i("svg",{class:T(["w-4 h-4 text-gray-400 transition-transform",b.value.has(n.ackId)?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[5]||(o[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("code",Xe,d(n.message.messageId.length>8?n.message.messageId.substring(0,8)+"...":n.message.messageId),1)])]),e("td",Ye,[e("div",Ze,[n.message.data?(l(),i("span",Ne,d(w(n.message.data).substring(0,50))+"...",1)):(l(),i("span",et,"(empty)"))])]),e("td",tt,[e("span",st,d(S(n.message.data)),1)]),e("td",at,[n.message.attributes&&Object.keys(n.message.attributes).length>0?(l(),i("span",ot,d(Object.keys(n.message.attributes).length)+" attr"+d(Object.keys(n.message.attributes).length!==1?"s":""),1)):(l(),i("span",rt,"-"))]),e("td",nt,[e("span",lt,d(P(new Date(n.message.publishTime))),1)]),e("td",it,[n.deliveryAttempt>1?(l(),i("span",dt,d(n.deliveryAttempt),1)):(l(),i("span",ct,"1"))]),e("td",ut,[e("button",{onClick:J(x=>a.subscription?.name&&a.$emit("acknowledge-message",a.subscription.name,n.ackId),["stop"]),disabled:a.isAcknowledging,class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/50 focus:outline-none focus:ring-1 focus:ring-green-500 disabled:opacity-50 transition-colors"},[p(y(ee),{class:"h-3 w-3 mr-1"}),o[6]||(o[6]=I(" Ack ",-1))],8,gt)])],8,Qe),b.value.has(n.ackId)?(l(),i("tr",mt,[e("td",pt,[e("div",yt,[e("div",null,[o[7]||(o[7]=e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 block mb-2"},"Full Message Data",-1)),e("div",xt,[n.message.data?(l(),i("span",bt,d(w(n.message.data)),1)):(l(),i("span",ht,"(empty)"))])]),n.message.attributes&&Object.keys(n.message.attributes).length>0?(l(),i("div",kt,[e("label",ft," Message Attributes ("+d(Object.keys(n.message.attributes).length)+") ",1),e("div",vt,[(l(!0),i(F,null,R(Object.entries(n.message.attributes),([x,k])=>(l(),i("div",{key:x,class:"flex items-start text-sm border-b border-gray-100 dark:border-gray-700 pb-2 last:border-0 last:pb-0"},[e("span",wt,d(x)+":",1),e("span",_t,d(k),1)]))),128))])])):z("",!0),e("div",$t,[e("div",null,[o[8]||(o[8]=e("label",{class:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide block"},"Message ID",-1)),e("div",Tt,d(n.message.messageId),1)]),e("div",null,[o[9]||(o[9]=e("label",{class:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide block"},"Published At",-1)),e("div",Ct,d(new Date(n.message.publishTime).toLocaleString()),1)]),e("div",null,[o[10]||(o[10]=e("label",{class:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide block"},"Ack ID",-1)),e("div",Dt,d(n.ackId),1)])])])])])):z("",!0)],64))),128))])])])])):(l(),i("div",St,[p(y(De),{class:"mx-auto h-12 w-12 text-gray-400 mb-4"}),o[13]||(o[13]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"No messages",-1)),o[14]||(o[14]=e("p",{class:"text-gray-500 dark:text-gray-400 mt-2"}," Pull messages to see them here ",-1)),e("button",{onClick:o[2]||(o[2]=n=>a.$emit("pull-messages")),disabled:a.isPulling,class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},[p(y(N),{class:T(["h-4 w-4 mr-2",{"animate-pulse":a.isPulling}])},null,8,["class"]),a.isPulling?(l(),i("span",Pt,[...o[12]||(o[12]=[I(" Pulling... ",-1),e("span",{class:"ml-2 text-xs opacity-75"},"(may take up to 3min)",-1)])])):(l(),i("span",Mt,"Pull Messages"))],8,At)]))])]),_:1},8,["modelValue"]))}}),Vt={class:"space-y-6"},It={key:0,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},Bt={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},Et={class:"text-center"},zt={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Ft={class:"mt-4"},Lt={key:2,class:"space-y-6"},Rt={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},Ot={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Ut={class:"flex items-center justify-between"},Ht={class:"text-lg font-medium text-gray-900 dark:text-white"},Kt={class:"flex items-center space-x-3"},qt=["disabled"],Gt={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},Qt=["id"],Wt=["onClick"],Jt={class:"flex items-center justify-between"},Xt={class:"flex items-start space-x-3"},Yt={class:"flex-1 min-w-0"},Zt={class:"flex items-center space-x-2 mb-1"},Nt={class:"text-sm font-medium text-gray-900 dark:text-white"},es={class:"text-xs text-gray-500 dark:text-gray-400"},ts={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300"},ss={key:0,class:"divide-y divide-gray-200 dark:divide-gray-700"},as=["onClick"],os={class:"flex items-start justify-between cursor-pointer"},rs={class:"flex items-start space-x-3 flex-1 cursor-pointer"},ns={class:"flex-1 min-w-0 cursor-pointer"},ls={class:"flex items-center space-x-2 mb-1"},is={class:"text-sm font-medium text-gray-900 dark:text-white"},ds={class:"text-xs text-gray-500 dark:text-gray-400 truncate"},cs={class:"mt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 text-xs cursor-pointer"},us={class:"flex items-center text-gray-600 dark:text-gray-400 cursor-pointer"},gs={class:"flex items-center text-gray-600 dark:text-gray-400 cursor-pointer"},ms={key:0,class:"flex items-center text-gray-600 dark:text-gray-400 cursor-pointer"},ps={class:"flex items-center space-x-2 ml-4"},ys=["onClick","disabled"],xs=["onClick","disabled"],bs={key:3,class:"space-y-6"},hs={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},ks={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},fs={class:"flex items-center justify-between"},vs={class:"flex items-center space-x-3"},ws=["disabled"],_s={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},$s={class:"text-center py-12"},Vs=te({__name:"SubscriptionsListView",setup(O){const V=me(),u=he(),g=L(()=>V.params.projectId),b=h([]),f=h(!1),v=h(null),C=h(new Map),D=h(new Set),w=h(new Set),P=h(!1),S=h(new Set),a=h(null),o=h(!1),n=h(!1),x=h(null),k=L(()=>{const t=new Map;return b.value.forEach(s=>{const r=s.topicName||"unknown";t.has(r)||t.set(r,[]),t.get(r).push(s)}),t.forEach(s=>{s.sort((r,c)=>(r.name||"").localeCompare(c.name||""))}),new Map([...t.entries()].sort(([s],[r])=>s.localeCompare(r)))}),j=t=>{if(!t)return"unknown";const s=t.split("/");return s[s.length-1]},_=t=>{if(!t)return"unknown";const s=t.split("/");return s[s.length-1]},A=async()=>{if(g.value){f.value=!0,v.value=null;try{console.log("Loading subscriptions for project:",g.value);const t=await E.getSubscriptions(g.value);console.log("Subscriptions API response in component:",t);const r=(Array.isArray(t)?t:[]).map(c=>({...c,topicName:c.topic||c.topicName||"unknown",projectId:g.value,id:c.name||`sub-${Date.now()}`,fullName:c.name||"",name:c.name||"",createdAt:new Date,updatedAt:new Date,ackDeadlineSeconds:c.ackDeadlineSeconds||60,messageCount:c.messageCount||0,undeliveredMessageCount:c.undeliveredMessageCount||0}));console.log("Transformed subscriptions:",r),b.value=r,S.value=new Set,await xe(),K()}catch(t){v.value=t.response?.data?.message||t.message||"Failed to load subscriptions",u.showToast({type:"error",title:"Error loading subscriptions"})}finally{f.value=!1}}},U=async(t,s=0)=>{if(!g.value||D.value.has(t.name))return;D.value.add(t.name);const r=_(t.name),c=Date.now(),M=setTimeout(()=>{u.showToast({type:"info",title:"Still pulling messages...",message:"This is taking longer than usual, please wait.",duration:5e3})},3e4),m=setTimeout(()=>{u.showToast({type:"warning",title:"Pull operation in progress",message:"This can take up to 3 minutes. Please be patient.",duration:8e3})},6e4);try{const $={subscription:t.name,maxMessages:1e3},B=new AbortController,de=setTimeout(()=>B.abort(),32e4),ce=await Promise.race([E.pullMessages(g.value,r,$),new Promise((Ts,ue)=>{B.signal.addEventListener("abort",()=>{ue(new Error("Pull operation timed out after 3 minutes"))})})]);clearTimeout(de);const Z=Math.round((Date.now()-c)/1e3),q=ce.receivedMessages||[];C.value.set(t.name,q),q.length>0?u.showToast({type:"success",title:`Pulled ${q.length} message(s)`,message:`Completed in ${Z}s`}):u.showToast({type:"info",title:"No messages available to pull",message:`Completed in ${Z}s`})}catch($){const B=Math.round((Date.now()-c)/1e3);if($.message?.includes("timed out")||$.name==="AbortError"){if(s<2)return u.showToast({type:"warning",title:"Pull timed out, retrying...",message:`Attempt ${s+2} of 3`}),clearTimeout(M),clearTimeout(m),D.value.delete(t.name),U(t,s+1);u.showToast({type:"error",title:"Pull operation failed",message:`Timed out after ${B}s. Try reducing maxMessages or check emulator performance.`})}else v.value=$.response?.data?.message||$.message||"Failed to pull messages",u.showToast({type:"error",title:"Error pulling messages",message:`Failed after ${B}s: ${v.value}`})}finally{clearTimeout(M),clearTimeout(m),D.value.delete(t.name)}},se=async t=>{if(!g.value||w.value.has(t))return;const s=C.value.get(t);if(!(!s||s.length===0)){w.value.add(t);try{const r=_(t),c=s.map(M=>M.ackId);await E.acknowledgeMessages(g.value,r,c),C.value.set(t,[]),u.showToast({type:"success",title:`Acknowledged ${c.length} message(s)`}),await A()}catch(r){v.value=r.response?.data?.message||r.message||"Failed to acknowledge messages",u.showToast({type:"error",title:"Error acknowledging messages"})}finally{w.value.delete(t)}}},ae=async(t,s)=>{if(!(!g.value||w.value.has(t))){w.value.add(t);try{const r=_(t);await E.acknowledgeMessages(g.value,r,[s]);const M=(C.value.get(t)||[]).filter(m=>m.ackId!==s);C.value.set(t,M),u.showToast({type:"success",title:"Message acknowledged"}),await A()}catch(r){v.value=r.response?.data?.message||r.message||"Failed to acknowledge message",u.showToast({type:"error",title:"Error acknowledging message"})}finally{w.value.delete(t)}}},oe=async t=>{x.value=t,n.value=!0},re=async()=>{if(!x.value||!g.value||P.value)return;const t=x.value,s=_(t.name);P.value=!0;try{console.log("Attempting to delete subscription:",s),await E.deleteSubscription(g.value,s),console.log("Delete API call successful"),u.showToast({type:"success",title:"Subscription Deleted",message:`Subscription "${s}" deleted successfully`}),b.value=b.value.filter(r=>_(r.name)!==s),await A()}catch(r){console.error("Error deleting subscription:",r),r.response?.status===404?(b.value=b.value.filter(c=>_(c.name)!==s),u.showToast({type:"info",title:"Subscription Removed",message:`Subscription "${s}" was already deleted or doesn't exist`})):u.showToast({type:"error",title:"Delete Failed",message:`Failed to delete subscription: ${r.message||"Unknown error"}`})}finally{P.value=!1,n.value=!1,x.value=null}},ne=()=>{n.value=!1,x.value=null},le=t=>{S.value.has(t)?S.value.delete(t):S.value.add(t)},H=t=>S.value.has(t),Y=async t=>{a.value=t,o.value=!0,await U(t)},ie=async()=>{a.value&&await U(a.value)},K=async()=>{const t=V.hash.slice(1)||window.location.hash.slice(1);await be(t,k.value,S.value,j)};return G(()=>g.value,(t,s)=>{t!==s&&t&&A()},{immediate:!0}),G(()=>k.value.size,t=>{t>0&&K()}),G(()=>V.hash,t=>{t&&k.value.size>0&&K()},{immediate:!0}),pe(()=>{g.value&&A()}),(t,s)=>(l(),i("div",Vt,[f.value?(l(),i("div",It,[...s[2]||(s[2]=[ye('<div class="animate-pulse"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"></div><div class="space-y-3"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded"></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/6"></div></div></div>',1)])])):v.value?(l(),i("div",Bt,[e("div",Et,[p(y(ke),{class:"mx-auto h-12 w-12 text-red-400"}),s[4]||(s[4]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Error Loading Subscriptions",-1)),e("p",zt,d(v.value),1),e("div",Ft,[e("button",{onClick:A,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors"},[p(y(Q),{class:"h-4 w-4 mr-2"}),s[3]||(s[3]=I(" Retry ",-1))])])])])):k.value.size>0?(l(),i("div",Lt,[e("div",Rt,[e("div",Ot,[e("div",Ut,[e("h2",Ht," Subscriptions ("+d(b.value.length)+") ",1),e("div",Kt,[e("button",{onClick:A,disabled:f.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"},[p(y(Q),{class:T(["h-4 w-4 mr-2",{"animate-spin":f.value}])},null,8,["class"]),s[5]||(s[5]=I(" Refresh ",-1))],8,qt)])])])]),e("div",Gt,[(l(!0),i(F,null,R(Array.from(k.value),([r,c],M)=>(l(),i("div",{key:r,class:T(M>0?"border-t border-gray-200 dark:border-gray-700":""),id:`topic-${j(r)}`},[e("div",{onClick:m=>le(r),class:T(["px-6 py-4 bg-white dark:bg-gray-800 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-b",H(r)?"border-gray-200 dark:border-gray-700":"border-transparent"])},[e("div",Jt,[e("div",Xt,[H(r)?(l(),W(y(ve),{key:1,class:"h-4 w-4 text-gray-400 transition-transform duration-200"})):(l(),W(y(fe),{key:0,class:"h-4 w-4 text-gray-400 transition-transform duration-200"})),p(y(we),{class:"h-5 w-5 text-blue-500 mt-0.5 shrink-0"}),e("div",Yt,[e("div",Zt,[e("span",Nt,d(j(r)),1)]),e("p",es,d(r),1)])]),e("span",ts,d((c||[]).length)+" subscription"+d((c||[]).length!==1?"s":""),1)])],10,Wt),H(r)?(l(),i("div",ss,[(l(!0),i(F,null,R(c,m=>(l(),i("div",{key:m.name,onClick:$=>Y(m),class:T(["px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer",a.value?.name===m.name?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500":""])},[e("div",os,[e("div",rs,[p(y(X),{class:"h-5 w-5 text-green-500 mt-0.5 shrink-0"}),e("div",ns,[e("div",ls,[e("span",is,d(_(m.name)),1)]),e("p",ds,d(m.name),1),e("div",cs,[e("div",us,[s[6]||(s[6]=e("svg",{class:"w-3 h-3 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s[7]||(s[7]=e("span",{class:"font-medium mr-1"},"Ack Deadline:",-1)),e("span",null,d(m.ackDeadlineSeconds)+"s",1)]),e("div",gs,[s[8]||(s[8]=e("svg",{class:"w-3 h-3 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})],-1)),s[9]||(s[9]=e("span",{class:"font-medium mr-1"},"Type:",-1)),e("span",null,d(m.pushConfig?.pushEndpoint?"Push":"Pull"),1)]),m.detached?(l(),i("div",ms,[...s[10]||(s[10]=[e("svg",{class:"w-3 h-3 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L5.636 5.636"})],-1),e("span",{class:"font-medium mr-1"},"Status:",-1),e("span",{class:"text-yellow-600 dark:text-yellow-400"},"Detached",-1)])])):z("",!0)])])]),e("div",ps,[e("button",{onClick:J($=>Y(m),["stop"]),disabled:D.value.has(m.name),class:"p-1.5 text-gray-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"View subscription messages"},[p(y(_e),{class:"w-4 h-4"})],8,ys),e("button",{onClick:J($=>oe(m),["stop"]),disabled:P.value,class:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete subscription"},[p(y($e),{class:"w-4 h-4"})],8,xs)])])],10,as))),128))])):z("",!0)],10,Qt))),128))])])):(l(),i("div",bs,[e("div",hs,[e("div",ks,[e("div",fs,[s[12]||(s[12]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Subscriptions (0) ",-1)),e("div",vs,[e("button",{onClick:A,disabled:f.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"},[p(y(Q),{class:T(["h-4 w-4 mr-2",{"animate-spin":f.value}])},null,8,["class"]),s[11]||(s[11]=I(" Refresh ",-1))],8,ws)])])])]),e("div",_s,[e("div",$s,[p(y(X),{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-600"}),s[13]||(s[13]=e("h3",{class:"mt-4 text-lg font-medium text-gray-900 dark:text-white"}," No subscriptions yet ",-1)),s[14]||(s[14]=e("p",{class:"mt-2 text-gray-600 dark:text-gray-400"}," Create subscriptions to start receiving messages from topics ",-1))])])])),p(jt,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=r=>o.value=r),subscription:a.value,"project-id":g.value,messages:a.value?C.value.get(a.value.name)||[]:[],"is-pulling":a.value?D.value.has(a.value.name):!1,"is-acknowledging":a.value?w.value.has(a.value.name):!1,onPullMessages:ie,onAcknowledgeMessage:ae,onAcknowledgeAll:se},null,8,["modelValue","subscription","project-id","messages","is-pulling","is-acknowledging"]),p(Ce,{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=r=>n.value=r),title:"Delete Subscription",message:`Are you sure you want to delete subscription '${x.value?_(x.value.name):""}'?`,"confirm-label":"Delete Subscription","is-loading":P.value,details:{title:"What will happen:",description:"The subscription will be permanently deleted and will stop receiving messages from its topic."},onConfirm:re,onCancel:ne},null,8,["modelValue","message","is-loading"])]))}});export{Vs as default};
