import{u as d,h as f}from"./index-CET3MO9v.js";import{f as r,r as p}from"./vendor-C_kCRdsv.js";import"./pinia-B2SWLoi0.js";import"./query-BV4EBN_X.js";const e=p({status:"unknown",lastChecked:null,error:null,retryCount:0});let n=null;function y(){const s=d(),a=r(()=>e.value.status==="connected"),u=r(()=>e.value.status==="disconnected"||e.value.status==="error"),l=r(()=>e.value.status==="checking");async function o(){e.value.status="checking",e.value.lastChecked=new Date;try{return await f.getHealthStatus(),e.value.status="connected",e.value.error=null,e.value.retryCount=0,!0}catch(t){return e.value.retryCount++,t.code===0||t.code==="ECONNREFUSED"||t.message?.includes("Network Error")?(e.value.status="disconnected",e.value.error="Unable to connect to the API server. Please check if the server is running and accessible."):t.response?.status>=500?(e.value.status="error",e.value.error=`Server error (${t.response.status}): The API server is experiencing issues.`):t.code==="ENOTFOUND"?(e.value.status="error",e.value.error="Cannot resolve the API server hostname. Please check the API URL configuration."):(e.value.status="error",e.value.error=`Connection failed: ${t.message||"Unknown error"}`),!1}}function i(t=3e4){n&&clearInterval(n),n=window.setInterval(()=>{e.value.status!=="checking"&&o()},t)}function c(){n&&(clearInterval(n),n=null)}async function v(){s.showToast({type:"info",title:"Retrying connection...",message:"Attempting to reconnect to the API server"});const t=await o();return t?s.showToast({type:"success",title:"Connection restored",message:"Successfully connected to the API server"}):s.showToast({type:"error",title:"Connection failed",message:e.value.error||"Unable to connect to the API server"}),t}function h(){e.value={status:"unknown",lastChecked:null,error:null,retryCount:0},c()}return{connectionState:r(()=>e.value),isConnected:a,isDisconnected:u,isChecking:l,checkConnection:o,startPeriodicCheck:i,stopPeriodicCheck:c,retryConnection:v,reset:h}}export{y as useApiConnection};
